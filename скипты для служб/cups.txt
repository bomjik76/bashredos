#!/bin/bash

#!!!!!!!!!!!!!надо добавить allow all
echo "Устанавливаем и настраиваем CUPS..."

# Установка CUPS
yum install -y cups

# Включение и запуск службы CUPS
systemctl enable cups
systemctl start cups

# Открытие доступа через локальную сеть
cupsd_conf="/etc/cups/cupsd.conf"
if ! grep -q "<Location />" "$cupsd_conf"; then
  sed -i 's/<Location \/>/<Location \/>\n  Allow @LOCAL\n/g' "$cupsd_conf"
fi
if ! grep -q "Listen 0.0.0.0:631" "$cupsd_conf"; then
  echo "Listen 0.0.0.0:631" >> "$cupsd_conf"
fi

# Перезапуск службы
systemctl restart cups

# Создание виртуального PDF-принтера
lpadmin -p Virtual_PDF_Printer -E -v cups-pdf:/ -m drv:///sample.drv/generic.ppd
lpadmin -d Virtual_PDF_Printer

echo "CUPS настроен. Виртуальный PDF-принтер опубликован."
